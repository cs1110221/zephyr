<?php	session_start();	require_once('connectiondata.php');	require_once('functions.php');	if(check_login_status()==false)	{		redirect('index.php');	}	//To check if the post variables are consistent	if(isset($_GET["item"])==false)	{		redirect('courses.php?courseid=' . $_GET["courseid"] . '&item=intro');	}	else if($_GET["item"] !="intro" && $_GET["item"] !="resources" && $_GET["item"] !="assignments" && $_GET["item"] !="gradesheet" && $_GET["item"] != "notifications")	{		redirect('courses.php?courseid=' . $_GET["courseid"] . '&item=intro');	}?><html><head>	<title>iPortal - Course</title> <!--Change Here -->	<link rel="stylesheet" href="css/courses.css" />	<?php include_once('header_includes.php'); ?></head><body><div class="mainBody">		<?php include_once('header.php'); ?>	<div class="main" >					<div class="coursecontainer">					<!-- Course Header -->			<div class="courseheader">				<center>					<h3 class="courseheadername">						<?php							$a = get_course_array($_GET["courseid"]);							if($a['facultyid']==$_SESSION['userid'])							{								$owner = true;							}							else							{								$owner = false;							}														//$owner = true;							if(sizeof($a)==6)							{								echo ($a['coursetype'] . $a['coursenumber'] . ": " . $a['coursename']);								$itemnumber = $_GET["itemnumber"];							}							else							{								echo ('Invalid Course Id');								echo('									</h3></center></div></div>									<div class="courseslist">												<div class="mycourseslistheader">											<center>												<h3 class="courseslistheaderh3">Courses</h3>											</center>										</div>										<div class="courseslistmain">										');										$coursearray = get_followed_courses($_SESSION['userid']);										for($i = 0;$i<sizeof($coursearray);$i++)										{											echo											('												<a href="courses.php?courseid=' . $coursearray[$i][2] . '">												<div class="courseslistmainitem"><center>												<h2 class="courselistitemname">' . $coursearray[$i][0] . '</h2></center></div></a>																						');										}																							echo('</div></div></div>');								include_once('footer.php');								echo('</body></html>');								exit();							}						?>					</h3>					<h4 class="coursefacultyname">Prof. <?php echo (get_faculty_name($a['facultyid'])) ?></h4>				</center>			</div>			<div class="coursemain">				<!-- List of available options -->				<div class="optionlist">									<?php						if($_GET["item"]=="intro")						{							echo("<a href='courses.php?courseid=" . $_GET['courseid'] . "&item=intro'><div class='optionlistitemselected'>");						}						else						{							echo("<a href='courses.php?courseid=" . $_GET['courseid'] . "&item=intro'><div class='optionlistitem'>");						}					?>					<center>					<h2 class="itemlistname">Introduction</h2>					</center></div></a>										<?php						if($_GET["item"]=="resources")						{							echo("<a href='courses.php?courseid=" . $_GET['courseid'] . "&item=resources'><div class='optionlistitemselected'>");						}						else						{							echo ("<a href='courses.php?courseid=" . $_GET['courseid'] . "&item=resources'><div class='optionlistitem'>");						}					?>					<center>					<h2 class="itemlistname">Resources</h2>					</center></div></a>										<?php						if($_GET["item"]=="assignments")						{							echo("<a href='courses.php?courseid=" . $_GET['courseid'] . "&item=assignments'><div class='optionlistitemselected'>");						}						else						{							echo ("<a href='courses.php?courseid=" . $_GET['courseid'] . "&item=assignments'><div class='optionlistitem'>");						}					?>					<center>					<h2 class="itemlistname">Assignments</h2>					</center></div></a>										<?php						if($_GET["item"]=="gradesheet")						{							echo("<a href='courses.php?courseid=" . $_GET['courseid'] . "&item=gradesheet'><div class='optionlistitemselected'>");						}						else						{							echo ("<a href='courses.php?courseid=" . $_GET['courseid'] . "&item=gradesheet'><div class='optionlistitem'>");						}					?>					<center>					<h2 class="itemlistname">Gradesheet</h2>					</center></div></a>					<?php						if($_GET["item"]=="notifications")						{							echo("<a href='courses.php?courseid=" . $_GET['courseid'] . "&item=notifications'><div class='optionlistitemselected'>");						}						else						{							echo ("<a href='courses.php?courseid=" . $_GET['courseid'] . "&item=notifications'><div class='optionlistitem'>");						}					?>					<center>					<h2 class="itemlistname">Notifications</h2>					</center></div></a>										<?php					if($owner==false)					{						if(is_course_followed($_SESSION['userid'],$_GET['courseid'])==true)						{							echo('								<a href="unfollowcourse.php?courseid='.$_GET['courseid'].'&item='.$_GET['item'].'">								<div class="optionlistitem"><center>								<h2 class="itemlistname">Unfollow Course</h2>								</center></div></a>							');						}						else						{							echo('								<a href="followcourse.php?courseid='.$_GET['courseid'].'&item='.$_GET['item'].'">								<div class="optionlistitem"><center>								<h2 class="itemlistname">Follow Course</h2>								</center></div></a>							');						}					}										if(isset($_SESSION['followresult']))					{						if(($_SESSION['followresult'])==1)						{							echo ('								<div class="alert alert-success" style="width: 70%; margin-left:auto; margin-right:auto; margin-top:10px; margin-bottom:0px"><a class="close" data-dismiss="alert">x</a> 								<strong>'.$_SESSION['followmessage'].'</strong></div>							');						}						if(($_SESSION['followresult'])==2)						{							echo ('								<div class="alert alert-error" style="width: 70%; margin-left:auto; margin-right:auto; margin-top:10px; margin-bottom:0px"><a class="close" data-dismiss="alert">x</a> 								<strong>'.$_SESSION['followmessage'].'</strong></div>							');						}						if(($_SESSION['followresult'])==3)						{							echo ('								<div class="alert" style="width: 70%; margin-left:auto; margin-right:auto; margin-top:10px; margin-bottom:0px"><a class="close" data-dismiss="alert">x</a> 								<strong>'.$_SESSION['followmessage'].'</strong></div>							');						}						unset($_SESSION['followresult']);						unset($_SESSION['followmessage']);					}											?>								</div>				<!-- The main content division -->				<div class="mainframe">				<?php										if($_REQUEST['item']=="intro")					{						echo("<div class='introdata'>".$a['courseintro']."</div>");					}					else if($_REQUEST['item']=="notifications")					{						//Adding Notifications in case the user is the faculty for the course						if($owner==true)						{							echo("<center><form class='addnotification' action='notificationadd.php' method='post'>");							echo("<input type='text' name='newnotification' class='input-large search-query span6' placeholder='New Notification...' autofocus='autofocus' style='height:30px; margin-top:10px;'>");							echo("<input type='submit' class='btn' name='submit' value='Add' style='float:right; margin-top:10px'>");							echo("<input type='hidden' name='courseid' value='".$_GET['courseid']."'>");							echo("</form></center>");													if(isset($_SESSION['notificationdeleteresult']))							{								if(($_SESSION['notificationdeleteresult'])==1)								{									echo ('										<div class="alert" style="width: 80%; margin-left:auto; margin-right:auto; margin-top:10px; margin-bottom:0px"><a class="close" data-dismiss="alert">x</a> 										<strong>Deleted!</strong> '.$_SESSION['notificationdeletemessage'].'</div>									');								}								else								{									echo ('										<div class="alert alert-error" style="width: 80%; margin-left:auto; margin-right:auto; margin-top:10px; margin-bottom:0px"><a class="close" data-dismiss="alert">x</a> 										<strong>Error!</strong> '.$_SESSION['notificationdeletemessage'].'</div>									');								}								unset($_SESSION['notificationdeleteresult']);								unset($_SESSION['notificationdeletemessage']);							}							else if(isset($_SESSION['notificationaddresult']))							{								if(($_SESSION['notificationaddresult'])==1)								{									echo ('										<div class="alert alert-success" style="width: 80%; margin-left:auto; margin-right:auto; margin-top:10px; margin-bottom:0px"><a class="close" data-dismiss="alert">x</a> 										<strong>Uploaded!</strong> '.$_SESSION['notificationaddmessage'].'</div>									');								}								else								{									echo ('										<div class="alert alert-error" style="width: 80%; margin-left:auto; margin-right:auto; margin-top:10px; margin-bottom:0px"><a class="close" data-dismiss="alert">x</a> 										<strong>Error!</strong> '.$_SESSION['notificationaddmessage'].'</div>									');								}								unset($_SESSION['notificationaddresult']);								unset($_SESSION['notificationaddmessage']);							}						}						echo('							<table class="notificationtable">								<center>								<thead class="notificationtablehead">								<tr>									<th style="word-wrap:break-word;width:60%;">Notification</th>									<th style="word-wrap:break-word;width:30%;">Date</th>');								if ($owner==true)								{									echo('<th style="word-wrap:break-word;width:10%;">Delete</th>');								}						echo('</tr></thead><tbody>');						$notifications = get_all_course_notifications($_REQUEST['courseid']);						$number = sizeof($notifications);						for($index=0; $index < $number; $index++)						{							echo("<tr>");							echo("<td valign='middle'>".$notifications[$index]['notification']."</td>");							echo("<td valign='middle'>".$notifications[$index]['timestamp']."</td>");							if($owner==true)							{								echo("<td valign='middle'><form action='\notificationdelete.php' method='post' style='height:10px'><input type='submit' class='btn' value='Delete'>");								echo("<input type='hidden' name='notificationid' value='".$notifications[$index]['id']."'>");								echo("<input type='hidden' name='courseid' value='".$_GET['courseid']."'></form>");							}							echo("</tr>");						}						echo("</table>");					}					else					{						if($owner==true)						{							//uploading files allowed in case the user is the faculty for the course							echo("<center><form class='formupload' action='uploadfile.php' method='post' enctype='multipart/form-data'>");															echo("								<div class='fileinput fileinput-new' data-provides='fileinput'> 									<div class='input-group'>										<div class='form-control uneditable-input' data-trigger='fileinput' style='width:240px'><i class='glyphicon glyphicon-file fileinput-exists'></i>											<span class='fileinput-filename'></span>										</div>    									<span class='input-group-addon btn btn-default btn-file'>	    									<span class='fileinput-new'>Select file</span>	    									<span class='fileinput-exists'>Change</span>	    									<input type='file' name='file'></span>	    									<a href='#'' class='input-group-addon btn btn-default fileinput-exists' data-dismiss='fileinput'>Remove</a>	    								</span>  									</div>								</div>							");							echo("<input type='submit' class='btn' name='submit' value='Upload' style='float:right'>");							echo("<input type='hidden' name='courseid' value='".$_GET['courseid']."'>");							echo("<input type='hidden' name='itemtype' value='".$_GET['item']."'>");							echo("</form></center>");													if(isset($_SESSION['deleteresult']))							{								if(($_SESSION['deleteresult'])==1)								{									echo ('										<div class="alert" style="width: 80%; margin-left:auto; margin-right:auto; margin-top:10px; margin-bottom:0px"><a class="close" data-dismiss="alert">x</a> 										<strong>Deleted!</strong> '.$_SESSION['deletemessage'].'</div>									');								}								else								{									echo ('										<div class="alert alert-error" style="width: 80%; margin-left:auto; margin-right:auto; margin-top:10px; margin-bottom:0px"><a class="close" data-dismiss="alert">x</a> 										<strong>Error!</strong> '.$_SESSION['deletemessage'].'</div>									');								}								unset($_SESSION['deleteresult']);								unset($_SESSION['deletemessage']);							}							else if(isset($_SESSION['uploadresult']))							{								if(($_SESSION['uploadresult'])==1)								{									echo ('										<div class="alert alert-success" style="width: 80%; margin-left:auto; margin-right:auto; margin-top:10px; margin-bottom:0px"><a class="close" data-dismiss="alert">x</a> 										<strong>Uploaded!</strong> '.$_SESSION['uploadmessage'].'</div>									');								}								else								{									echo ('										<div class="alert alert-error" style="width: 80%; margin-left:auto; margin-right:auto; margin-top:10px; margin-bottom:0px"><a class="close" data-dismiss="alert">x</a> 										<strong>Error!</strong> '.$_SESSION['uploadmessage'].'</div>									');								}								unset($_SESSION['uploadresult']);								unset($_SESSION['uploadmessage']);							}						}						//The file details table						echo('							<table class="filetable">								<center>								<thead class="filetablehead">								<tr>									<th style="word-wrap:break-word;width:40%;">Filename</th>									<th style="word-wrap:break-word;width:20%;">Type</th>									<th style="word-wrap:break-word;width:20%;">Size</th>									<th style="word-wrap:break-word;width:10%;">Download</th> ');								if ($owner==true)								{									echo('<th style="word-wrap:break-word;width:10%;">Delete</th>');								}						echo('</tr></thead><tbody>');						$dir = "courses/".$a['courseid']."/".$_REQUEST['item']."/";						$myDirectory = opendir($dir);						while(false !== ($newfile = readdir($myDirectory)))						{							$dirArray[] = $newfile;						}						closedir($myDirectory);						$numberofFiles = count($dirArray);						//sort($dirArray);						for($index=0; $index < $numberofFiles; $index++)						{							$favicon="";							$name = $dirArray[$index];							if(!is_dir($dirArray[$index]))							{								$extn = pathinfo($dirArray[$index],PATHINFO_EXTENSION);								$extn = pretty_filetype($extn);								$size = pretty_filesize($dir,$dirArray[$index]);								$sizekey = filesize($dir.$dirArray[$index]);								echo("<tr>");								echo("<td valign='middle'><a href='".$dir.htmlentities($name,ENT_QUOTES)."' target='_blank'>".$name."</td>");								echo("<td valign='middle'>".$extn."</td>");								echo("<td valign='middle' sorttable_customkey='".$sizekey."''>".$size."</td>");								echo("<td valign='middle'><input type='button' class='btn' value='Download' onclick=\"location.href='".$dir.htmlentities($name,ENT_QUOTES)."'\";></td>");								if($owner==true)								{									echo("<td valign='middle'><form action='deletefile.php' method='post' enctype='multipart/form-data' style='height:10px'><input type='submit' class='btn' value='Delete'>");									echo("<input type='hidden' name='filepath' value='".$dir.htmlentities($name,ENT_QUOTES)."'>");									echo("<input type='hidden' name='courseid' value='".$_GET['courseid']."'>");									echo("<input type='hidden' name='itemtype' value='".$_GET['item']."'></form></td>");								}								echo("</tr>");							}						}						echo("</table>");					}				?>				</div>			</div>					</div>	</div>		<?php include_once('footer.php'); ?></body></html>